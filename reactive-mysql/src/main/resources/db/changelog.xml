<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">



    <changeSet id="create-users-history" author="ramanouski">
        <createTable tableName="users">
            <column name="id" type="varchar(128)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="subscription_id" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addAutoIncrement
                columnDataType="int"
                columnName="id"
                startWith="1"
                tableName="users"/>
<!--        incrementBy="1"-->


        <createTable tableName="history">
            <column name="id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="payload" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="datetime">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addAutoIncrement
                columnDataType="int"
                columnName="id"
                startWith="1"
                tableName="history"/>
    </changeSet>


    <changeSet id="add-constraints-indexes" author="ramanouski">
        <addUniqueConstraint tableName="users" columnNames="user_id, subscription_id" constraintName="user_subscription_constraint"/>
        <createIndex tableName="history" indexName="history_user_index">
            <column name="user_id"/>
        </createIndex>
        <createIndex tableName="users" indexName="users_user_index">
            <column name="user_id"/>
        </createIndex>
    </changeSet>



</databaseChangeLog>